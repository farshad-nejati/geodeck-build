import m from"../../../_snowpack/pkg/localforage.js";import u from"../../../_snowpack/pkg/lodash.js";onmessage=function(e){console.log("Worker: Message received from main script");const t=e.data,o=d(t),n=p(t),s=y(n);m.setItem("all",n),m.setItem("meta",o),I(s)};const I=e=>{const t=Array.from(e.keys());m.setItem("years",t);let o=[],n=0;for(let s of e.keys()){const a=e.get(s);o[n]=m.setItem(s,a),n++}Promise.all(o).then(()=>{postMessage({finish:!0,first:u.toInteger(t[0])})})},d=e=>{const t=c(e,"Latitude"),o=i(e,"Latitude"),n=c(e,"Longitude"),s=i(e,"Longitude"),a=c(e,"Depth"),r=i(e,"Depth"),g=c(e,"Magnitude"),l=i(e,"Magnitude");return{x:o-t,minX:t,maxX:o,y:s-n,minY:n,maxY:s,z:r-a,minZ:a,maxZ:r,minMagnitude:g,maxMagnitude:l,radius:l-g}},p=e=>e?.reduce((t,o)=>[...t,...o],[]),y=e=>{const t=new Map;return e?.map(o=>{const n=new Date(o?.Date).getFullYear().toString();if(t.has(n)){const s=t.get(n);t.set(n,[...s,o])}else t.set(n,[o])}),t},c=(e,t)=>e?.reduce((n,s)=>{const a=u.minBy(s,r=>r[t]);return a[t]>n?n:a[t]},Number.POSITIVE_INFINITY),i=(e,t)=>e?.reduce((n,s)=>{const a=u.maxBy(s,r=>r[t]);return a[t]>n?a[t]:n},Number.NEGATIVE_INFINITY);
