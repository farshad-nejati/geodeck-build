import u,{useEffect as d,useState as p}from"../../../_snowpack/pkg/react.js";import{Upload as f,Button as x}from"../../../_snowpack/pkg/antd.js";import{dummyRequest as y}from"../3d-page/helpers.js";import*as l from"../../helpers/xlsx-helper.js";import{overlaysVar as M}from"../../apollo/cache.js";const v=e=>e?.reduce((t,n)=>[...t,...n],[]),B=e=>{const t=new Map;return e?.map(n=>{const o=new Date(n?.Date).getFullYear();if(t.has(o)){const a=t.get(o);t.set(o,[...a,n])}else t.set(o,[n])}),t},C=e=>{const t=l.getMinByColumn(e,"Latitude"),n=l.getMaxByColumn(e,"Latitude"),o=l.getMinByColumn(e,"Longitude"),a=l.getMaxByColumn(e,"Longitude"),m=l.getMinByColumn(e,"Depth"),i=l.getMaxByColumn(e,"Depth"),s=l.getMinByColumn(e,"Magnitude"),c=l.getMaxByColumn(e,"Magnitude");return{x:n-t,minX:t,maxX:n,y:a-o,minY:o,maxY:a,z:i-m,minZ:m,maxZ:i,minMagnitude:s,maxMagnitude:c,radius:c-s}},L=()=>{const[e,t]=p(!1),[n,o]=p([]),[a,m]=p([]),i=s=>{const{fileList:c}=s,r=c.map(g=>g.originFileObj);o(r)};return d(()=>{n?.map(s=>{t(!0),l.readExcel(s).then(c=>{m([...a,...c]),t(!1)})})},[n]),d(()=>{console.time("items");const s=v(a);console.timeEnd("items"),console.time("map");const c=B(s);console.timeEnd("map"),console.log(c);const r=C(a);M({items:s,meta:r})},[a]),e?u.createElement("div",null,"loading..."):u.createElement(f,{multiple:!0,onChange:i,accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",showUploadList:!1,customRequest:y},u.createElement(x,null,"Overlays"))};export default L;
