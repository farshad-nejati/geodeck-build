import*as k from"../../../_snowpack/env.js";import.meta.env=k;import s,{useEffect as l,useState as r}from"../../../_snowpack/pkg/react.js";import{Upload as h,Button as y}from"../../../_snowpack/pkg/antd.js";import{dummyRequest as g}from"../3d-page/helpers.js";import*as j from"../../helpers/xlsx-helper.js";import{newOverlayVar as p}from"../../apollo/cache.js";import{activeOverlayVar as W}from"../../apollo/cache.js";const _=()=>{const[m,n]=r(!1),[i,c]=r([]),[t,d]=r([]),[a,f]=r(null);l(()=>(a||(window.overlayWorker=new Worker(new URL("./overlay-worker.js",import.meta.url),{name:"overlayWorker",type:"module"}),window.overlayWorker.onmessage=o=>{const e=o.data;e?.finish&&(n(!1),p(!p()),W(e?.first))},f(window.overlayWorker)),()=>{window.overlayWorker.terminate(),delete window.overlayWorker}),[]);const u=o=>{const{fileList:e}=o,w=e.map(v=>v.originFileObj);c(w)};return l(()=>{i?.map(o=>{n(!0),j.readExcel(o).then(e=>{d([...t,...e])})})},[i]),l(()=>{a&&!!t.length&&a.postMessage(t)},[t]),m?s.createElement("div",null,"loading..."):s.createElement(h,{multiple:!0,onChange:u,accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",showUploadList:!1,customRequest:g},s.createElement(y,null,"Overlays"))};export default _;
