import n,{useEffect as D,useState as L}from"https://cdn.skypack.dev/react";import s from"https://cdn.skypack.dev/lodash";import{Card as R,message as V,Modal as w}from"https://cdn.skypack.dev/antd";import{Typography as M}from"https://cdn.skypack.dev/antd";import{useLazyQuery as q,useMutation as v,useReactiveVar as F}from"https://cdn.skypack.dev/@apollo/client";import{GET_SAMPLE_OF_OBJECT as j}from"../../apollo/queries/index.js";import"../../apollo/cache.js";import{UPDATE_PLOT as G,DELETE_PLOT as Q}from"../../apollo/mutations/index.js";import{plotsVar as U}from"../../apollo/cache.js";import B from"../../apollo/client.js";import H from"./plot-chart.js";import{DeleteOutlined as J,ExclamationCircleOutlined as Y}from"https://cdn.skypack.dev/@ant-design/icons";const{Text:K}=M,W=d=>{const[c,h]=L([]),{id:o,name:l,isActive:m,type:k,variable:y,objects:X,onSelectPlot:_,onUpdatePlot:E,variableObjects:r}=d,O=`plot-${o}`,{active:P}=F(U),[g]=v(G),[N]=v(Q),[x]=q(j,{onCompleted:e=>{const t=e?.sampleOfObject;if(console.log(e),t?.data){const a=f(t);console.log(`call getSample API (objectId: ${t.objectId})--------`),p(a)}else m&&V.warning({content:"No data point is available!",key:O,duration:1})}}),p=e=>{const a=c?.find(i=>i.containerName===e.containerName)?T(e):[...c,e];h(a)},f=e=>{if(!e)return null;const t=r.find(i=>i?.object?.id===e.objectId&&i?.variable?.id===e.variableId),a=s.capitalize(t?.variable?.containerName);return{id:t?.id,name:`${a} - ${s.capitalize(t?.object.name)}`,containerName:a,data:e?.data}};D(()=>{r?.length&&r?.map(e=>{const t=e?.object?.id,a=e?.variable?.id;if(c.find(A=>A.id===e?.id))return;const z=B.readQuery({query:j,variables:{objectId:t,variableId:a}}),b=f(z?.sampleOfObject);b?p(b):x({variables:{objectId:t,variableId:a}})})},[r,c]);const S=()=>{o!==P?.id&&_(o)},T=e=>c.map(t=>t.containerName===e.containerName?e:t),C=e=>{if(e===l||!e)return;const t={name:e};E(o,t),g({variables:{plotId:o,object:t}})},I=()=>{d.onDeletePlot(o),N({variables:{plotId:o}})},u=()=>{w.confirm({centered:!0,title:"Confirm",icon:n.createElement(Y,null),content:"Are you sure to delete this plot?",okText:"Yes",cancelText:"No",onOk:()=>{I()}})},$=()=>n.createElement("div",{className:"plot__header"},n.createElement(K,{className:"plot__header__title",editable:{onChange:C,autoSize:{minRows:1,maxRows:1}}},`${s.truncate(l,{length:43})}`),!c.length&&n.createElement("div",{className:"plot__header__delete"},n.createElement(J,{onClick:u,style:{fontSize:"16px"}})));return n.createElement(n.Fragment,null,n.createElement(R,{className:`card__plot ${m?"active":""}`,key:o,onClick:S},$(),n.createElement(H,{id:o,name:l,type:k,variable:y,series:c,onDeletePlot:u})))};export default W;
