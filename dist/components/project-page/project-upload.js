import e,{useEffect as w,useState as p}from"../../../_snowpack/pkg/react.js";import"../../../_snowpack/pkg/lodash.js";import{Form as l,Input as f,Button as u,Select as g,Upload as E,message as k}from"../../../_snowpack/pkg/antd.js";import{UploadOutlined as R}from"../../../_snowpack/pkg/@ant-design/icons.js";import{dummyRequest as T}from"../3d-page/helpers.js";const{Option:b}=g;function G(n){return new Promise((r,s)=>{const a=new FileReader;a.readAsBinaryString(n.originFileObj),a.onload=()=>r(a.result),a.onerror=m=>s(m)})}const U=n=>n?.split(".").pop(),B=n=>{const[r,s]=p(null),[a,m]=p(null),[i,y]=p("gltf"),{form:F,loading:_}=n,c=i==="_blank";let d="Create";_&&(d="Creating..."),w(()=>{a&&(s(null),m(!1))},[r]);const I=t=>U(t?.name)!==i?(k.error("Invalid Type!"),E.LIST_IGNORE):!0,j=async t=>{const o=t?.file;s(o?.originFileObj)},C=t=>{if(!r&&!c)k.error("File not selected!");else{const o={...t,modelFile:r};n.onCompleted(o)}},h=t=>{console.log("Failed:",t)},v={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},x=(t,o)=>o?Promise.resolve():Promise.reject(`${t.field} is required`);return e.createElement(l,{...v,name:"project-upload",form:F,onFinish:C,onFinishFailed:h},e.createElement(l.Item,{label:"Type"},e.createElement(g,{defaultValue:i,onChange:t=>y(t)},e.createElement(b,{value:"gltf"},"GLTF File"),e.createElement(b,{value:"_blank"},"Blank"))),!c&&e.createElement(l.Item,{label:"Data Endpoint URL"},e.createElement(l.Item,{name:"url",noStyle:!0,rules:[{type:"url",message:"please enter a url!"},{validator:x}]},e.createElement(f,{placeholder:"https://example.com",type:"url"}))),!c&&e.createElement(l.Item,{label:"File"},e.createElement(E,{maxCount:1,beforeUpload:I,onChange:j,onRemove:()=>m(!0),accept:`.${i}`,customRequest:T},e.createElement(u,{icon:e.createElement(R,null)},"Upload"))),e.createElement(l.Item,{className:"margin-0 project__form__buttons"},e.createElement(f.Group,{className:"grid__two"},e.createElement(l.Item,{className:"margin-0"},e.createElement(u,{block:!0,type:"default",onClick:n.onCancel},"Back")),e.createElement(l.Item,{className:"margin-0"},e.createElement(u,{block:!0,type:"primary",loading:n?.loading,disabled:n?.loading,htmlType:"submit"},d)))))};export default B;
