import e,{useState as m}from"https://cdn.skypack.dev/react";import{Link as g}from"https://cdn.skypack.dev/react-router-dom";import{Typography as w,Modal as F,Result as N,Button as d,Form as S}from"https://cdn.skypack.dev/antd";import{useMutation as T,useReactiveVar as u}from"https://cdn.skypack.dev/@apollo/client";import{CREATE_PROJECT as x}from"../../apollo/mutations/index.js";import{GET_PROJECTS as R}from"../../apollo/queries/index.js";import{projectsVar as j,activeProjectVar as f}from"../../apollo/cache.js";import V from"./project-upload.js";import{CheckCircleFilled as A,PlusOutlined as D}from"https://cdn.skypack.dev/@ant-design/icons";import M from"./project-form-create.js";const{Title:O}=w,q=()=>{const[c]=S.useForm(),i=localStorage.getItem("sub"),k=u(f),[E,a]=m(!1),s=u(j),[o,r]=m(0),[l,p]=m({}),[y,{loading:v}]=T(x,{refetchQueries:[{query:R,variables:{userID:i}}],onCompleted:t=>{C(t?.createProject),r(o+1)}}),C=t=>{const n=P(t);j(n),f(t)},P=t=>({...s,items:[t,...s?.items],total:s.total+1}),b=t=>{r(o+1),p({...l,...t})},_=t=>{const n={...l,...t};y({variables:{userID:i,...n}})},h=()=>{switch(o){case 0:return e.createElement(M,{data:l,form:c,onCompleted:b,onCancel:()=>a(!1)});case 1:return e.createElement(V,{form:c,onCompleted:_,onCancel:()=>r(o-1),loading:v});case 2:return e.createElement(N,{status:"success",title:"Project Successfully Created!",icon:e.createElement(A,{style:{fontSize:"48px"}}),extra:[e.createElement(d,{block:!0,type:"primary",key:"go"},e.createElement(g,{to:`project/${k?.id}`},"Go To Project")),e.createElement(d,{block:!0,key:"done",onClick:()=>{c.resetFields(),a(!1),r(0),p({})}},"Done")]});default:break}};return e.createElement(e.Fragment,null,e.createElement("div",{className:"card__project project__new",onClick:()=>a(!0)},e.createElement("div",{className:"project__new__logo"},e.createElement(D,null)),e.createElement(O,{level:5,type:"secondary"},"Add New Project")),e.createElement(F,{title:"Add New Project",centered:!0,closable:null,visible:E,footer:null,className:"project__modal"},h()))};export default q;
