import e,{useState as m}from"../../../_snowpack/pkg/react.js";import{Link as v}from"../../../_snowpack/pkg/react-router-dom.js";import{Typography as F,Modal as N,Result as S,Button as u,Form as T}from"../../../_snowpack/pkg/antd.js";import{useMutation as h,useReactiveVar as d}from"../../../_snowpack/pkg/@apollo/client.js";import{CREATE_PROJECT as x}from"../../apollo/mutations/index.js";import{GET_PROJECTS as R}from"../../apollo/queries/index.js";import{projectsVar as j,activeProjectVar as f}from"../../apollo/cache.js";import V from"./project-upload.js";import{CheckCircleFilled as A,PlusOutlined as D}from"../../../_snowpack/pkg/@ant-design/icons.js";import M from"./project-form-create.js";const{Title:O}=F,q=()=>{const[c]=T.useForm(),i=localStorage.getItem("sub"),k=d(f),[E,a]=m(!1),s=d(j),[o,r]=m(0),[l,p]=m({}),[_,{loading:C}]=h(x,{refetchQueries:[{query:R,variables:{userID:i}}],onCompleted:t=>{P(t?.createProject),r(o+1)}}),P=t=>{const n=b(t);j(n),f(t)},b=t=>({...s,items:[t,...s?.items],total:s.total+1}),g=t=>{r(o+1),p({...l,...t})},w=t=>{const n={...l,...t};_({variables:{userID:i,...n}})},y=()=>{switch(o){case 0:return e.createElement(M,{data:l,form:c,onCompleted:g,onCancel:()=>a(!1)});case 1:return e.createElement(V,{form:c,onCompleted:w,onCancel:()=>r(o-1),loading:C});case 2:return e.createElement(S,{status:"success",title:"Project Successfully Created!",icon:e.createElement(A,{style:{fontSize:"48px"}}),extra:[e.createElement(u,{block:!0,type:"primary",key:"go"},e.createElement(v,{to:`project/${k?.id}`},"Go To Project")),e.createElement(u,{block:!0,key:"done",onClick:()=>{c.resetFields(),a(!1),r(0),p({})}},"Done")]});default:break}};return e.createElement(e.Fragment,null,e.createElement("div",{className:"card__project project__new",onClick:()=>a(!0)},e.createElement("div",{className:"project__new__logo"},e.createElement(D,null)),e.createElement(O,{level:5,type:"secondary"},"Add New Project")),e.createElement(N,{title:"Add New Project",centered:!0,closable:null,visible:E,footer:null,className:"project__modal"},y()))};export default q;
