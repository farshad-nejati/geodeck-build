import e from"../../../_snowpack/pkg/react.js";import d from"../../../_snowpack/pkg/lodash.js";import{Form as o,Input as n,Button as E,Select as h}from"../../../_snowpack/pkg/antd.js";import{useMutation as j}from"../../../_snowpack/pkg/@apollo/client.js";import{CREATE_PROJECT as k,UPDATE_PROJECT as P}from"../../apollo/mutations/index.js";import{GET_PROJECTS as f}from"../../apollo/queries/index.js";import"../../apollo/cache.js";const{Option:U}=h,T=l=>{const m=localStorage.getItem("sub"),[i]=o.useForm(),r=l?.project,a=!d.isEmpty(r),[F,{loading:p}]=j(k,{refetchQueries:[{query:f,variables:{userID:m}}],onCompleted:t=>{console.log(t),l.onCompleted(t?.createProject),i.resetFields()}}),[g,{loading:u}]=j(P,{refetchQueries:[{query:f,variables:{userID:m}}],onCompleted:t=>{console.log(t),l.onCompleted(t?.updateProject)}}),b={title:a?r?.title:null,url:a?r?.url:null,description:a?r?.description:null},y=t=>{if(a){const s=r?.id,_=d.pick(t,["title","description"]);g({variables:{projectId:s,object:_}})}else l.onCompleted(t)},C=t=>{console.log("Failed:",t)},c=(t,s)=>s?Promise.resolve():Promise.reject(`${t.field} is required`),I={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}};return e.createElement(o,{...I,name:"project-form",form:i,onFinish:y,onFinishFailed:C,initialValues:b},e.createElement(o.Item,{label:"Project Title"},e.createElement(o.Item,{name:"title",noStyle:!0,rules:[{validator:c}]},e.createElement(n,{placeholder:"Title"}))),e.createElement(o.Item,{label:"Data Endpoint URL"},e.createElement(o.Item,{name:"url",noStyle:!0,rules:[{type:"url",message:"please enter a url!"},{validator:c}]},e.createElement(n,{placeholder:"https://example.com",type:"url"}))),e.createElement(o.Item,{label:"Description"},e.createElement(o.Item,{name:"description",noStyle:!0,rules:[{validator:c}]},e.createElement(n,{placeholder:"Type description here"}))),e.createElement(o.Item,{className:"margin-0 project__form__buttons"},e.createElement(n.Group,{className:"grid__two"},e.createElement(o.Item,{className:"margin-0"},e.createElement(E,{block:!0,type:"default",onClick:l.onCancel},"Cancel")),e.createElement(o.Item,{className:"margin-0"},e.createElement(E,{block:!0,type:"primary",loading:p||u,disabled:p||u,htmlType:"submit"},a?"Update":"Next")))))};export default T;
