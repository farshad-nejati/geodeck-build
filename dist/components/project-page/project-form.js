import e from"https://cdn.skypack.dev/react";import u from"https://cdn.skypack.dev/lodash";import{Form as o,Input as n,Button as E,Select as k}from"https://cdn.skypack.dev/antd";import{useMutation as f}from"https://cdn.skypack.dev/@apollo/client";import{CREATE_PROJECT as P,UPDATE_PROJECT as v}from"../../apollo/mutations/index.js";import{GET_PROJECTS as y}from"../../apollo/queries/index.js";import"../../apollo/cache.js";const{Option:w}=k,T=l=>{const m=localStorage.getItem("sub"),[i]=o.useForm(),r=l?.project,a=!u.isEmpty(r),[_,{loading:p}]=f(P,{refetchQueries:[{query:y,variables:{userID:m}}],onCompleted:t=>{console.log(t),l.onCompleted(t?.createProject),i.resetFields()}}),[j,{loading:d}]=f(v,{refetchQueries:[{query:y,variables:{userID:m}}],onCompleted:t=>{console.log(t),l.onCompleted(t?.updateProject)}}),h={title:a?r?.title:null,url:a?r?.url:null,description:a?r?.description:null},b=t=>{if(a){const s=r?.id,I=u.pick(t,["title","description"]);j({variables:{projectId:s,object:I}})}else l.onCompleted(t)},g=t=>{console.log("Failed:",t)},c=(t,s)=>s?Promise.resolve():Promise.reject(`${t.field} is required`),C={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}};return e.createElement(o,{...C,name:"project-form",form:i,onFinish:b,onFinishFailed:g,initialValues:h},e.createElement(o.Item,{label:"Project Title"},e.createElement(o.Item,{name:"title",noStyle:!0,rules:[{validator:c}]},e.createElement(n,{placeholder:"Title"}))),e.createElement(o.Item,{label:"Data Endpoint URL"},e.createElement(o.Item,{name:"url",noStyle:!0,rules:[{type:"url",message:"please enter a url!"},{validator:c}]},e.createElement(n,{placeholder:"https://example.com",type:"url"}))),e.createElement(o.Item,{label:"Description"},e.createElement(o.Item,{name:"description",noStyle:!0,rules:[{validator:c}]},e.createElement(n,{placeholder:"Type description here"}))),e.createElement(o.Item,{className:"margin-0 project__form__buttons"},e.createElement(n.Group,{className:"grid__two"},e.createElement(o.Item,{className:"margin-0"},e.createElement(E,{block:!0,type:"default",onClick:l.onCancel},"Cancel")),e.createElement(o.Item,{className:"margin-0"},e.createElement(E,{block:!0,type:"primary",loading:p||d,disabled:p||d,htmlType:"submit"},a?"Update":"Next")))))};export default T;
