import t,{useEffect as p,useState as I}from"https://cdn.skypack.dev/react";import{useParams as S}from"https://cdn.skypack.dev/react-router-dom";import r from"https://cdn.skypack.dev/lodash";import{useLazyQuery as b,useQuery as x,useReactiveVar as m}from"https://cdn.skypack.dev/@apollo/client";import R from"../components/studio-page/change-bar.js";import{activeProjectVar as l,containersVar as V,activePanelVar as A}from"../apollo/cache.js";import{GET_CONTAINERS as D,GET_PROJECTS as T}from"../apollo/queries/index.js";import d from"../components/3d-page/index.js";import M from"../components/2d-page/index.js";import"../components/spinner/index.js";import{useHistory as N}from"https://cdn.skypack.dev/react-router";import{getContainersData as _}from"../data/containers-data.js";import*as u from"../helpers/container.js";import"https://cdn.skypack.dev/@react-three/drei";const G=L=>{const f=N();let{pId:c,id:O}=S();const a=m(l),s=m(A),v=localStorage.getItem("sub"),[g,E]=I({fov:50,position:[-1.33,-2.26,-47.43],rotation:[-2.67,-1.23,.24]}),{loading:j,error:y,data:h}=x(T,{variables:{userID:v},onCompleted:e=>{const o=e?.projectModel?.items?.find(n=>n.id===r.toInteger(c));l(o)}});p(()=>{const e=r.toInteger(localStorage.getItem("activePanel"));(e!==s||!e)&&localStorage.setItem("activePanel",s)},[]),p(()=>{(!r.isEmpty(y)||r.isEmpty(a)&&!r.isEmpty(h))&&f.push("/project"),r.isEmpty(a)||k({variables:{projectId:r.toInteger(c)}})},[a]);const[k]=b(D,{onCompleted:e=>{const o=e?.containerModel;i(o)},onError:()=>{const o=_()?.containerModel;i(o)}}),i=e=>{const o=e?.items,n=u.create(o),P=u.findActive(n);V({containers:n,active:P})},C=()=>{switch(s){case 1:return t.createElement(d,{camera:g,setCamera:E});case 2:return t.createElement(M,null);case 3:return t.createElement("div",{className:""},t.createElement("div",null,"VR page"),t.createElement(R,{toggle:!1}));case 4:return null;default:return t.createElement(d,null)}};return j||r.isEmpty(a)?null:t.createElement(t.Fragment,null,C())};export default G;
