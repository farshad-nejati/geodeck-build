import t,{useEffect as f,useState as u}from"../../_snowpack/pkg/react.js";import C from"../../_snowpack/pkg/lodash.js";import{useLazyQuery as D,useMutation as O,useReactiveVar as v}from"../../_snowpack/pkg/@apollo/client.js";import{useHistory as V}from"../../_snowpack/pkg/react-router.js";import{Empty as N,Image as R}from"../../_snowpack/pkg/antd.js";import x from"../components/gallery-page/gallery-card.js";import T from"../components/gallery-page/gallery-sidebar.js";import{filesOfGalleryVar as n,activeProjectVar as q}from"../apollo/cache.js";import{GET_FILES_OF_GALLERY as E}from"../apollo/queries/index.js";import{DELETE_FILE_OF_GALLERY as H}from"../apollo/mutations/index.js";import Q from"../components/spinner/index.js";import Y from"../components/gallery-page/gallery-preview.js";import{galleryPreviewImageVar as c}from"../apollo/cache.js";import z from"../components/gallery-page/gallery-sort.js";const m=[{key:"all",filter:"image",title:"All"},{key:"image",filter:"image",title:"Images"},{key:"video",filter:"video",title:"Videos"}],d=[{key:"id",label:"Default",value:"id",order:"DESC"},{key:"title",label:"Title",value:"title",order:"ASC"},{key:"updatedAt",label:"Date",value:"updatedAt",order:"DESC"}],B=M=>{const J=V(),i=q(),l=v(n),[a,_]=u(d[0]),[s,k]=u(m[0]),p=v(c),j=i?.gallery?.id,[I]=O(H,{refetchQueries:[{query:E,variables:{galleryId:i?.gallery?.id,fieldSort:a.value,order:a.order}}]}),[g,{loading:S,error:G}]=D(E,{fetchPolicy:"no-cache",onCompleted:e=>{n(e?.filesOfGallery)}});if(f(()=>{g({variables:{galleryId:i?.gallery?.id,fieldSort:a.value,order:a.order}})},[]),f(()=>{g({variables:{galleryId:i?.gallery?.id,fieldSort:a.value,order:a.order,type:s.filter}})},[a,s]),G)return t.createElement("p",null,"Error :(");const w=e=>{const r=d.find(o=>o.value===e);_(r)},F=e=>{const r=m.find(o=>o.key===e);k(r)},h=e=>{const r=l?.items.filter(y=>y.id!==e),o={...l,items:r,total:l.total-1};I({variables:{galleryId:j,fileId:e}}),n(o)},b=l?.items?.map(e=>C.pick(e,["title","url","varying"])),A=e=>{const o=l?.items?.find((y,P)=>P===e);c({index:e,...o})},L=()=>t.createElement(t.Fragment,null,t.createElement(T,{filters:m,activeFilter:s,onFilter:F}),t.createElement("div",{className:"gallery__contents__container"},t.createElement(z,{sorts:d,activeSort:a,onSort:w}),S?t.createElement(Q,null):l?.total===0?t.createElement(N,null):t.createElement("div",{className:"gallery__cards grid__gallery"},t.createElement(R.PreviewGroup,null,l?.items?.map((e,r)=>t.createElement(x,{onClickImage:()=>c({index:r,...e}),key:r,...e,items:b}))))));return t.createElement("div",{className:"gallery"},t.createElement("div",{className:"gallery__contents"},p?t.createElement(Y,{itemslength:l?.items?.length,item:p,onDelete:h,onChangeImage:A}):L()))};export default t.memo(B);
